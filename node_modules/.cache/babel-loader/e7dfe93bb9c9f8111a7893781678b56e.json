{"ast":null,"code":"/**\n * implements https://w3c.github.io/accname/\n */\nimport ArrayFrom from \"./polyfills/array.from.mjs\";\nimport SetLike from \"./polyfills/SetLike.mjs\";\nimport { hasAnyConcreteRoles, isElement, isHTMLTableCaptionElement, isHTMLInputElement, isHTMLSelectElement, isHTMLTextAreaElement, safeWindow, isHTMLFieldSetElement, isHTMLLegendElement, isHTMLOptGroupElement, isHTMLTableElement, isHTMLSlotElement, isSVGSVGElement, isSVGTitleElement, queryIdRefs, getLocalName } from \"./util.mjs\";\n/**\n *  A string of characters where all carriage returns, newlines, tabs, and form-feeds are replaced with a single space, and multiple spaces are reduced to a single space. The string contains only character data; it does not contain any markup.\n */\n\n/**\n *\n * @param {string} string -\n * @returns {FlatString} -\n */\n\nfunction asFlatString(s) {\n  return s.trim().replace(/\\s\\s+/g, \" \");\n}\n/**\n *\n * @param node -\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\n * @returns {boolean} -\n */\n\n\nfunction isHidden(node, getComputedStyleImplementation) {\n  if (!isElement(node)) {\n    return false;\n  }\n\n  if (node.hasAttribute(\"hidden\") || node.getAttribute(\"aria-hidden\") === \"true\") {\n    return true;\n  }\n\n  var style = getComputedStyleImplementation(node);\n  return style.getPropertyValue(\"display\") === \"none\" || style.getPropertyValue(\"visibility\") === \"hidden\";\n}\n/**\n * @param {Node} node -\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\n */\n\n\nfunction isControl(node) {\n  return hasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) || hasAbstractRole(node, \"range\");\n}\n\nfunction hasAbstractRole(node, role) {\n  if (!isElement(node)) {\n    return false;\n  }\n\n  switch (role) {\n    case \"range\":\n      return hasAnyConcreteRoles(node, [\"meter\", \"progressbar\", \"scrollbar\", \"slider\", \"spinbutton\"]);\n\n    default:\n      throw new TypeError(\"No knowledge about abstract role '\".concat(role, \"'. This is likely a bug :(\"));\n  }\n}\n/**\n * element.querySelectorAll but also considers owned tree\n * @param element\n * @param selectors\n */\n\n\nfunction querySelectorAllSubtree(element, selectors) {\n  var elements = ArrayFrom(element.querySelectorAll(selectors));\n  queryIdRefs(element, \"aria-owns\").forEach(function (root) {\n    // babel transpiles this assuming an iterator\n    elements.push.apply(elements, ArrayFrom(root.querySelectorAll(selectors)));\n  });\n  return elements;\n}\n\nfunction querySelectedOptions(listbox) {\n  if (isHTMLSelectElement(listbox)) {\n    // IE11 polyfill\n    return listbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\");\n  }\n\n  return querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\n}\n\nfunction isMarkedPresentational(node) {\n  return hasAnyConcreteRoles(node, [\"none\", \"presentation\"]);\n}\n/**\n * Elements specifically listed in html-aam\n *\n * We don't need this for `label` or `legend` elements.\n * Their implicit roles already allow \"naming from content\".\n *\n * sources:\n *\n * - https://w3c.github.io/html-aam/#table-element\n */\n\n\nfunction isNativeHostLanguageTextAlternativeElement(node) {\n  return isHTMLTableCaptionElement(node);\n}\n/**\n * https://w3c.github.io/aria/#namefromcontent\n */\n\n\nfunction allowsNameFromContent(node) {\n  return hasAnyConcreteRoles(node, [\"button\", \"cell\", \"checkbox\", \"columnheader\", \"gridcell\", \"heading\", \"label\", \"legend\", \"link\", \"menuitem\", \"menuitemcheckbox\", \"menuitemradio\", \"option\", \"radio\", \"row\", \"rowheader\", \"switch\", \"tab\", \"tooltip\", \"treeitem\"]);\n}\n/**\n * TODO https://github.com/eps1lon/dom-accessibility-api/issues/100\n */\n\n\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement( // eslint-disable-next-line @typescript-eslint/no-unused-vars -- not implemented yet\nnode) {\n  return false;\n}\n\nfunction getValueOfTextbox(element) {\n  if (isHTMLInputElement(element) || isHTMLTextAreaElement(element)) {\n    return element.value;\n  } // https://github.com/eps1lon/dom-accessibility-api/issues/4\n\n\n  return element.textContent || \"\";\n}\n\nfunction getTextualContent(declaration) {\n  var content = declaration.getPropertyValue(\"content\");\n\n  if (/^[\"'].*[\"']$/.test(content)) {\n    return content.slice(1, -1);\n  }\n\n  return \"\";\n}\n/**\n * https://html.spec.whatwg.org/multipage/forms.html#category-label\n * TODO: form-associated custom elements\n * @param element\n */\n\n\nfunction isLabelableElement(element) {\n  var localName = getLocalName(element);\n  return localName === \"button\" || localName === \"input\" && element.getAttribute(\"type\") !== \"hidden\" || localName === \"meter\" || localName === \"output\" || localName === \"progress\" || localName === \"select\" || localName === \"textarea\";\n}\n/**\n * > [...], then the first such descendant in tree order is the label element's labeled control.\n * -- https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param element\n */\n\n\nfunction findLabelableElement(element) {\n  if (isLabelableElement(element)) {\n    return element;\n  }\n\n  var labelableElement = null;\n  element.childNodes.forEach(function (childNode) {\n    if (labelableElement === null && isElement(childNode)) {\n      var descendantLabelableElement = findLabelableElement(childNode);\n\n      if (descendantLabelableElement !== null) {\n        labelableElement = descendantLabelableElement;\n      }\n    }\n  });\n  return labelableElement;\n}\n/**\n * Polyfill of HTMLLabelElement.control\n * https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param label\n */\n\n\nfunction getControlOfLabel(label) {\n  if (label.control !== undefined) {\n    return label.control;\n  }\n\n  var htmlFor = label.getAttribute(\"for\");\n\n  if (htmlFor !== null) {\n    return label.ownerDocument.getElementById(htmlFor);\n  }\n\n  return findLabelableElement(label);\n}\n/**\n * Polyfill of HTMLInputElement.labels\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/labels\n * @param element\n */\n\n\nfunction getLabels(element) {\n  var labelsProperty = element.labels;\n\n  if (labelsProperty === null) {\n    return labelsProperty;\n  }\n\n  if (labelsProperty !== undefined) {\n    return ArrayFrom(labelsProperty);\n  } // polyfill\n\n\n  if (!isLabelableElement(element)) {\n    return null;\n  }\n\n  var document = element.ownerDocument;\n  return ArrayFrom(document.querySelectorAll(\"label\")).filter(function (label) {\n    return getControlOfLabel(label) === element;\n  });\n}\n/**\n * Gets the contents of a slot used for computing the accname\n * @param slot\n */\n\n\nfunction getSlotContents(slot) {\n  // Computing the accessible name for elements containing slots is not\n  // currently defined in the spec. This implementation reflects the\n  // behavior of NVDA 2020.2/Firefox 81 and iOS VoiceOver/Safari 13.6.\n  var assignedNodes = slot.assignedNodes();\n\n  if (assignedNodes.length === 0) {\n    // if no nodes are assigned to the slot, it displays the default content\n    return ArrayFrom(slot.childNodes);\n  }\n\n  return assignedNodes;\n}\n/**\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\n * @param root\n * @param options\n * @returns\n */\n\n\nexport function computeTextAlternative(root) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var consultedNodes = new SetLike();\n  var window = safeWindow(root);\n  var _options$compute = options.compute,\n      compute = _options$compute === void 0 ? \"name\" : _options$compute,\n      _options$computedStyl = options.computedStyleSupportsPseudoElements,\n      computedStyleSupportsPseudoElements = _options$computedStyl === void 0 ? options.getComputedStyle !== undefined : _options$computedStyl,\n      _options$getComputedS = options.getComputedStyle,\n      getComputedStyle = _options$getComputedS === void 0 ? window.getComputedStyle.bind(window) : _options$getComputedS,\n      _options$hidden = options.hidden,\n      hidden = _options$hidden === void 0 ? false : _options$hidden; // 2F.i\n\n  function computeMiscTextAlternative(node, context) {\n    var accumulatedText = \"\";\n\n    if (isElement(node) && computedStyleSupportsPseudoElements) {\n      var pseudoBefore = getComputedStyle(node, \"::before\");\n      var beforeContent = getTextualContent(pseudoBefore);\n      accumulatedText = \"\".concat(beforeContent, \" \").concat(accumulatedText);\n    } // FIXME: Including aria-owns is not defined in the spec\n    // But it is required in the web-platform-test\n\n\n    var childNodes = isHTMLSlotElement(node) ? getSlotContents(node) : ArrayFrom(node.childNodes).concat(queryIdRefs(node, \"aria-owns\"));\n    childNodes.forEach(function (child) {\n      var result = computeTextAlternative(child, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false,\n        recursion: true\n      }); // TODO: Unclear why display affects delimiter\n      // see https://github.com/w3c/accname/issues/3\n\n      var display = isElement(child) ? getComputedStyle(child).getPropertyValue(\"display\") : \"inline\";\n      var separator = display !== \"inline\" ? \" \" : \"\"; // trailing separator for wpt tests\n\n      accumulatedText += \"\".concat(separator).concat(result).concat(separator);\n    });\n\n    if (isElement(node) && computedStyleSupportsPseudoElements) {\n      var pseudoAfter = getComputedStyle(node, \"::after\");\n      var afterContent = getTextualContent(pseudoAfter);\n      accumulatedText = \"\".concat(accumulatedText, \" \").concat(afterContent);\n    }\n\n    return accumulatedText.trim();\n  }\n  /**\n   *\n   * @param element\n   * @param attributeName\n   * @returns A string non-empty string or `null`\n   */\n\n\n  function useAttribute(element, attributeName) {\n    var attribute = element.getAttributeNode(attributeName);\n\n    if (attribute !== null && !consultedNodes.has(attribute) && attribute.value.trim() !== \"\") {\n      consultedNodes.add(attribute);\n      return attribute.value;\n    }\n\n    return null;\n  }\n\n  function computeTooltipAttributeValue(node) {\n    if (!isElement(node)) {\n      return null;\n    }\n\n    return useAttribute(node, \"title\");\n  }\n\n  function computeElementTextAlternative(node) {\n    if (!isElement(node)) {\n      return null;\n    } // https://w3c.github.io/html-aam/#fieldset-and-legend-elements\n\n\n    if (isHTMLFieldSetElement(node)) {\n      consultedNodes.add(node);\n      var children = ArrayFrom(node.childNodes);\n\n      for (var i = 0; i < children.length; i += 1) {\n        var child = children[i];\n\n        if (isHTMLLegendElement(child)) {\n          return computeTextAlternative(child, {\n            isEmbeddedInLabel: false,\n            isReferenced: false,\n            recursion: false\n          });\n        }\n      }\n    } else if (isHTMLTableElement(node)) {\n      // https://w3c.github.io/html-aam/#table-element\n      consultedNodes.add(node);\n\n      var _children = ArrayFrom(node.childNodes);\n\n      for (var _i = 0; _i < _children.length; _i += 1) {\n        var _child = _children[_i];\n\n        if (isHTMLTableCaptionElement(_child)) {\n          return computeTextAlternative(_child, {\n            isEmbeddedInLabel: false,\n            isReferenced: false,\n            recursion: false\n          });\n        }\n      }\n    } else if (isSVGSVGElement(node)) {\n      // https://www.w3.org/TR/svg-aam-1.0/\n      consultedNodes.add(node);\n\n      var _children2 = ArrayFrom(node.childNodes);\n\n      for (var _i2 = 0; _i2 < _children2.length; _i2 += 1) {\n        var _child2 = _children2[_i2];\n\n        if (isSVGTitleElement(_child2)) {\n          return _child2.textContent;\n        }\n      }\n\n      return null;\n    } else if (getLocalName(node) === \"img\" || getLocalName(node) === \"area\") {\n      // https://w3c.github.io/html-aam/#area-element\n      // https://w3c.github.io/html-aam/#img-element\n      var nameFromAlt = useAttribute(node, \"alt\");\n\n      if (nameFromAlt !== null) {\n        return nameFromAlt;\n      }\n    } else if (isHTMLOptGroupElement(node)) {\n      var nameFromLabel = useAttribute(node, \"label\");\n\n      if (nameFromLabel !== null) {\n        return nameFromLabel;\n      }\n    }\n\n    if (isHTMLInputElement(node) && (node.type === \"button\" || node.type === \"submit\" || node.type === \"reset\")) {\n      // https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\n      var nameFromValue = useAttribute(node, \"value\");\n\n      if (nameFromValue !== null) {\n        return nameFromValue;\n      } // TODO: l10n\n\n\n      if (node.type === \"submit\") {\n        return \"Submit\";\n      } // TODO: l10n\n\n\n      if (node.type === \"reset\") {\n        return \"Reset\";\n      }\n    }\n\n    var labels = getLabels(node);\n\n    if (labels !== null && labels.length !== 0) {\n      consultedNodes.add(node);\n      return ArrayFrom(labels).map(function (element) {\n        return computeTextAlternative(element, {\n          isEmbeddedInLabel: true,\n          isReferenced: false,\n          recursion: true\n        });\n      }).filter(function (label) {\n        return label.length > 0;\n      }).join(\" \");\n    } // https://w3c.github.io/html-aam/#input-type-image-accessible-name-computation\n    // TODO: wpt test consider label elements but html-aam does not mention them\n    // We follow existing implementations over spec\n\n\n    if (isHTMLInputElement(node) && node.type === \"image\") {\n      var _nameFromAlt = useAttribute(node, \"alt\");\n\n      if (_nameFromAlt !== null) {\n        return _nameFromAlt;\n      }\n\n      var nameFromTitle = useAttribute(node, \"title\");\n\n      if (nameFromTitle !== null) {\n        return nameFromTitle;\n      } // TODO: l10n\n\n\n      return \"Submit Query\";\n    }\n\n    if (hasAnyConcreteRoles(node, [\"button\"])) {\n      // https://www.w3.org/TR/html-aam-1.0/#button-element\n      var nameFromSubTree = computeMiscTextAlternative(node, {\n        isEmbeddedInLabel: false,\n        isReferenced: false\n      });\n\n      if (nameFromSubTree !== \"\") {\n        return nameFromSubTree;\n      }\n    }\n\n    return null;\n  }\n\n  function computeTextAlternative(current, context) {\n    if (consultedNodes.has(current)) {\n      return \"\";\n    } // 2A\n\n\n    if (!hidden && isHidden(current, getComputedStyle) && !context.isReferenced) {\n      consultedNodes.add(current);\n      return \"\";\n    } // 2B\n\n\n    var labelElements = queryIdRefs(current, \"aria-labelledby\");\n\n    if (compute === \"name\" && !context.isReferenced && labelElements.length > 0) {\n      return labelElements.map(function (element) {\n        return computeTextAlternative(element, {\n          isEmbeddedInLabel: context.isEmbeddedInLabel,\n          isReferenced: true,\n          // thais isn't recursion as specified, otherwise we would skip\n          // `aria-label` in\n          // <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\n          recursion: false\n        });\n      }).join(\" \");\n    } // 2C\n    // Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\n    // spec says we should only consider skipping if we have a non-empty label\n\n\n    var skipToStep2E = context.recursion && isControl(current) && compute === \"name\";\n\n    if (!skipToStep2E) {\n      var ariaLabel = (isElement(current) && current.getAttribute(\"aria-label\") || \"\").trim();\n\n      if (ariaLabel !== \"\" && compute === \"name\") {\n        consultedNodes.add(current);\n        return ariaLabel;\n      } // 2D\n\n\n      if (!isMarkedPresentational(current)) {\n        var elementTextAlternative = computeElementTextAlternative(current);\n\n        if (elementTextAlternative !== null) {\n          consultedNodes.add(current);\n          return elementTextAlternative;\n        }\n      }\n    } // special casing, cheating to make tests pass\n    // https://github.com/w3c/accname/issues/67\n\n\n    if (hasAnyConcreteRoles(current, [\"menu\"])) {\n      consultedNodes.add(current);\n      return \"\";\n    } // 2E\n\n\n    if (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\n      if (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\n        consultedNodes.add(current);\n        var selectedOptions = querySelectedOptions(current);\n\n        if (selectedOptions.length === 0) {\n          // defined per test `name_heading_combobox`\n          return isHTMLInputElement(current) ? current.value : \"\";\n        }\n\n        return ArrayFrom(selectedOptions).map(function (selectedOption) {\n          return computeTextAlternative(selectedOption, {\n            isEmbeddedInLabel: context.isEmbeddedInLabel,\n            isReferenced: false,\n            recursion: true\n          });\n        }).join(\" \");\n      }\n\n      if (hasAbstractRole(current, \"range\")) {\n        consultedNodes.add(current);\n\n        if (current.hasAttribute(\"aria-valuetext\")) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n          return current.getAttribute(\"aria-valuetext\");\n        }\n\n        if (current.hasAttribute(\"aria-valuenow\")) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n          return current.getAttribute(\"aria-valuenow\");\n        } // Otherwise, use the value as specified by a host language attribute.\n\n\n        return current.getAttribute(\"value\") || \"\";\n      }\n\n      if (hasAnyConcreteRoles(current, [\"textbox\"])) {\n        consultedNodes.add(current);\n        return getValueOfTextbox(current);\n      }\n    } // 2F: https://w3c.github.io/accname/#step2F\n\n\n    if (allowsNameFromContent(current) || isElement(current) && context.isReferenced || isNativeHostLanguageTextAlternativeElement(current) || isDescendantOfNativeHostLanguageTextAlternativeElement(current)) {\n      var accumulatedText2F = computeMiscTextAlternative(current, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false\n      });\n\n      if (accumulatedText2F !== \"\") {\n        consultedNodes.add(current);\n        return accumulatedText2F;\n      }\n    }\n\n    if (current.nodeType === current.TEXT_NODE) {\n      consultedNodes.add(current);\n      return current.textContent || \"\";\n    }\n\n    if (context.recursion) {\n      consultedNodes.add(current);\n      return computeMiscTextAlternative(current, {\n        isEmbeddedInLabel: context.isEmbeddedInLabel,\n        isReferenced: false\n      });\n    }\n\n    var tooltipAttributeValue = computeTooltipAttributeValue(current);\n\n    if (tooltipAttributeValue !== null) {\n      consultedNodes.add(current);\n      return tooltipAttributeValue;\n    } // TODO should this be reachable?\n\n\n    consultedNodes.add(current);\n    return \"\";\n  }\n\n  return asFlatString(computeTextAlternative(root, {\n    isEmbeddedInLabel: false,\n    // by spec computeAccessibleDescription starts with the referenced elements as roots\n    isReferenced: compute === \"description\",\n    recursion: false\n  }));\n}","map":{"version":3,"mappings":"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","names":["ArrayFrom","SetLike","hasAnyConcreteRoles","isElement","isHTMLTableCaptionElement","isHTMLInputElement","isHTMLSelectElement","isHTMLTextAreaElement","safeWindow","isHTMLFieldSetElement","isHTMLLegendElement","isHTMLOptGroupElement","isHTMLTableElement","isHTMLSlotElement","isSVGSVGElement","isSVGTitleElement","queryIdRefs","getLocalName","asFlatString","s","trim","replace","isHidden","node","getComputedStyleImplementation","hasAttribute","getAttribute","style","getPropertyValue","isControl","hasAbstractRole","role","TypeError","querySelectorAllSubtree","element","selectors","elements","querySelectorAll","forEach","root","push","apply","querySelectedOptions","listbox","selectedOptions","isMarkedPresentational","isNativeHostLanguageTextAlternativeElement","allowsNameFromContent","isDescendantOfNativeHostLanguageTextAlternativeElement","getValueOfTextbox","value","textContent","getTextualContent","declaration","content","test","slice","isLabelableElement","localName","findLabelableElement","labelableElement","childNodes","childNode","descendantLabelableElement","getControlOfLabel","label","control","undefined","htmlFor","ownerDocument","getElementById","getLabels","labelsProperty","labels","document","filter","getSlotContents","slot","assignedNodes","length","computeTextAlternative","options","consultedNodes","window","compute","_options$compute","_options$computedStyl","computedStyleSupportsPseudoElements","getComputedStyle","_options$getComputedS","bind","_options$hidden","hidden","computeMiscTextAlternative","context","accumulatedText","pseudoBefore","beforeContent","concat","child","result","isEmbeddedInLabel","isReferenced","recursion","display","separator","pseudoAfter","afterContent","useAttribute","attributeName","attribute","getAttributeNode","has","add","computeTooltipAttributeValue","computeElementTextAlternative","children","i","nameFromAlt","nameFromLabel","type","nameFromValue","map","join","nameFromTitle","nameFromSubTree","current","labelElements","skipToStep2E","ariaLabel","elementTextAlternative","selectedOption","accumulatedText2F","nodeType","TEXT_NODE","tooltipAttributeValue"],"sources":["C:\\Users\\patri\\OneDrive\\New folder\\Documentos\\vsCode\\facebrain\\node_modules\\dom-accessibility-api\\sources\\accessible-name-and-description.ts"],"sourcesContent":["/**\n * implements https://w3c.github.io/accname/\n */\nimport ArrayFrom from \"./polyfills/array.from\";\nimport SetLike from \"./polyfills/SetLike\";\nimport {\n\thasAnyConcreteRoles,\n\tisElement,\n\tisHTMLTableCaptionElement,\n\tisHTMLInputElement,\n\tisHTMLSelectElement,\n\tisHTMLTextAreaElement,\n\tsafeWindow,\n\tisHTMLFieldSetElement,\n\tisHTMLLegendElement,\n\tisHTMLOptGroupElement,\n\tisHTMLTableElement,\n\tisHTMLSlotElement,\n\tisSVGSVGElement,\n\tisSVGTitleElement,\n\tqueryIdRefs,\n\tgetLocalName,\n} from \"./util\";\n\n/**\n *  A string of characters where all carriage returns, newlines, tabs, and form-feeds are replaced with a single space, and multiple spaces are reduced to a single space. The string contains only character data; it does not contain any markup.\n */\ntype FlatString = string & {\n\t__flat: true;\n};\n\n/**\n * interface for an options-bag where `window.getComputedStyle` can be mocked\n */\nexport interface ComputeTextAlternativeOptions {\n\tcompute?: \"description\" | \"name\";\n\t/**\n\t * Set to true if window.computedStyle supports the second argument.\n\t * This should be false in JSDOM. Otherwise JSDOM will log console errors.\n\t */\n\tcomputedStyleSupportsPseudoElements?: boolean;\n\t/**\n\t * mock window.getComputedStyle. Needs `content`, `display` and `visibility`\n\t */\n\tgetComputedStyle?: typeof window.getComputedStyle;\n\t/**\n\t * Set to `true` if you want to include hidden elements in the accessible name and description computation.\n\t * Skips 2A in https://w3c.github.io/accname/#computation-steps.\n\t * @default false\n\t */\n\thidden?: boolean;\n}\n\n/**\n *\n * @param {string} string -\n * @returns {FlatString} -\n */\nfunction asFlatString(s: string): FlatString {\n\treturn s.trim().replace(/\\s\\s+/g, \" \") as FlatString;\n}\n\n/**\n *\n * @param node -\n * @param options - These are not optional to prevent accidentally calling it without options in `computeAccessibleName`\n * @returns {boolean} -\n */\nfunction isHidden(\n\tnode: Node,\n\tgetComputedStyleImplementation: typeof window.getComputedStyle\n): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\tnode.hasAttribute(\"hidden\") ||\n\t\tnode.getAttribute(\"aria-hidden\") === \"true\"\n\t) {\n\t\treturn true;\n\t}\n\n\tconst style = getComputedStyleImplementation(node);\n\treturn (\n\t\tstyle.getPropertyValue(\"display\") === \"none\" ||\n\t\tstyle.getPropertyValue(\"visibility\") === \"hidden\"\n\t);\n}\n\n/**\n * @param {Node} node -\n * @returns {boolean} - As defined in step 2E of https://w3c.github.io/accname/#mapping_additional_nd_te\n */\nfunction isControl(node: Node): boolean {\n\treturn (\n\t\thasAnyConcreteRoles(node, [\"button\", \"combobox\", \"listbox\", \"textbox\"]) ||\n\t\thasAbstractRole(node, \"range\")\n\t);\n}\n\nfunction hasAbstractRole(node: Node, role: string): node is Element {\n\tif (!isElement(node)) {\n\t\treturn false;\n\t}\n\n\tswitch (role) {\n\t\tcase \"range\":\n\t\t\treturn hasAnyConcreteRoles(node, [\n\t\t\t\t\"meter\",\n\t\t\t\t\"progressbar\",\n\t\t\t\t\"scrollbar\",\n\t\t\t\t\"slider\",\n\t\t\t\t\"spinbutton\",\n\t\t\t]);\n\t\tdefault:\n\t\t\tthrow new TypeError(\n\t\t\t\t`No knowledge about abstract role '${role}'. This is likely a bug :(`\n\t\t\t);\n\t}\n}\n\n/**\n * element.querySelectorAll but also considers owned tree\n * @param element\n * @param selectors\n */\nfunction querySelectorAllSubtree(\n\telement: Element,\n\tselectors: string\n): Element[] {\n\tconst elements = ArrayFrom(element.querySelectorAll(selectors));\n\n\tqueryIdRefs(element, \"aria-owns\").forEach((root) => {\n\t\t// babel transpiles this assuming an iterator\n\t\telements.push.apply(elements, ArrayFrom(root.querySelectorAll(selectors)));\n\t});\n\n\treturn elements;\n}\n\nfunction querySelectedOptions(listbox: Element): ArrayLike<Element> {\n\tif (isHTMLSelectElement(listbox)) {\n\t\t// IE11 polyfill\n\t\treturn (\n\t\t\tlistbox.selectedOptions || querySelectorAllSubtree(listbox, \"[selected]\")\n\t\t);\n\t}\n\treturn querySelectorAllSubtree(listbox, '[aria-selected=\"true\"]');\n}\n\nfunction isMarkedPresentational(node: Node): node is Element {\n\treturn hasAnyConcreteRoles(node, [\"none\", \"presentation\"]);\n}\n\n/**\n * Elements specifically listed in html-aam\n *\n * We don't need this for `label` or `legend` elements.\n * Their implicit roles already allow \"naming from content\".\n *\n * sources:\n *\n * - https://w3c.github.io/html-aam/#table-element\n */\nfunction isNativeHostLanguageTextAlternativeElement(\n\tnode: Node\n): node is Element {\n\treturn isHTMLTableCaptionElement(node);\n}\n\n/**\n * https://w3c.github.io/aria/#namefromcontent\n */\nfunction allowsNameFromContent(node: Node): boolean {\n\treturn hasAnyConcreteRoles(node, [\n\t\t\"button\",\n\t\t\"cell\",\n\t\t\"checkbox\",\n\t\t\"columnheader\",\n\t\t\"gridcell\",\n\t\t\"heading\",\n\t\t\"label\",\n\t\t\"legend\",\n\t\t\"link\",\n\t\t\"menuitem\",\n\t\t\"menuitemcheckbox\",\n\t\t\"menuitemradio\",\n\t\t\"option\",\n\t\t\"radio\",\n\t\t\"row\",\n\t\t\"rowheader\",\n\t\t\"switch\",\n\t\t\"tab\",\n\t\t\"tooltip\",\n\t\t\"treeitem\",\n\t]);\n}\n\n/**\n * TODO https://github.com/eps1lon/dom-accessibility-api/issues/100\n */\nfunction isDescendantOfNativeHostLanguageTextAlternativeElement(\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars -- not implemented yet\n\tnode: Node\n): boolean {\n\treturn false;\n}\n\nfunction getValueOfTextbox(element: Element): string {\n\tif (isHTMLInputElement(element) || isHTMLTextAreaElement(element)) {\n\t\treturn element.value;\n\t}\n\t// https://github.com/eps1lon/dom-accessibility-api/issues/4\n\treturn element.textContent || \"\";\n}\n\nfunction getTextualContent(declaration: CSSStyleDeclaration): string {\n\tconst content = declaration.getPropertyValue(\"content\");\n\tif (/^[\"'].*[\"']$/.test(content)) {\n\t\treturn content.slice(1, -1);\n\t}\n\treturn \"\";\n}\n\n/**\n * https://html.spec.whatwg.org/multipage/forms.html#category-label\n * TODO: form-associated custom elements\n * @param element\n */\nfunction isLabelableElement(element: Element): boolean {\n\tconst localName = getLocalName(element);\n\n\treturn (\n\t\tlocalName === \"button\" ||\n\t\t(localName === \"input\" && element.getAttribute(\"type\") !== \"hidden\") ||\n\t\tlocalName === \"meter\" ||\n\t\tlocalName === \"output\" ||\n\t\tlocalName === \"progress\" ||\n\t\tlocalName === \"select\" ||\n\t\tlocalName === \"textarea\"\n\t);\n}\n\n/**\n * > [...], then the first such descendant in tree order is the label element's labeled control.\n * -- https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param element\n */\nfunction findLabelableElement(element: Element): Element | null {\n\tif (isLabelableElement(element)) {\n\t\treturn element;\n\t}\n\tlet labelableElement: Element | null = null;\n\telement.childNodes.forEach((childNode) => {\n\t\tif (labelableElement === null && isElement(childNode)) {\n\t\t\tconst descendantLabelableElement = findLabelableElement(childNode);\n\t\t\tif (descendantLabelableElement !== null) {\n\t\t\t\tlabelableElement = descendantLabelableElement;\n\t\t\t}\n\t\t}\n\t});\n\n\treturn labelableElement;\n}\n\n/**\n * Polyfill of HTMLLabelElement.control\n * https://html.spec.whatwg.org/multipage/forms.html#labeled-control\n * @param label\n */\nfunction getControlOfLabel(label: HTMLLabelElement): Element | null {\n\tif (label.control !== undefined) {\n\t\treturn label.control;\n\t}\n\n\tconst htmlFor = label.getAttribute(\"for\");\n\tif (htmlFor !== null) {\n\t\treturn label.ownerDocument.getElementById(htmlFor);\n\t}\n\n\treturn findLabelableElement(label);\n}\n\n/**\n * Polyfill of HTMLInputElement.labels\n * https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/labels\n * @param element\n */\nfunction getLabels(element: Element): HTMLLabelElement[] | null {\n\tconst labelsProperty = (element as HTMLInputElement).labels as\n\t\t| HTMLInputElement[\"labels\"]\n\t\t| undefined;\n\n\tif (labelsProperty === null) {\n\t\treturn labelsProperty;\n\t}\n\tif (labelsProperty !== undefined) {\n\t\treturn ArrayFrom(labelsProperty);\n\t}\n\n\t// polyfill\n\tif (!isLabelableElement(element)) {\n\t\treturn null;\n\t}\n\tconst document = element.ownerDocument;\n\n\treturn ArrayFrom(document.querySelectorAll(\"label\")).filter((label) => {\n\t\treturn getControlOfLabel(label) === element;\n\t});\n}\n\n/**\n * Gets the contents of a slot used for computing the accname\n * @param slot\n */\nfunction getSlotContents(slot: HTMLSlotElement): Node[] {\n\t// Computing the accessible name for elements containing slots is not\n\t// currently defined in the spec. This implementation reflects the\n\t// behavior of NVDA 2020.2/Firefox 81 and iOS VoiceOver/Safari 13.6.\n\tconst assignedNodes = slot.assignedNodes();\n\tif (assignedNodes.length === 0) {\n\t\t// if no nodes are assigned to the slot, it displays the default content\n\t\treturn ArrayFrom(slot.childNodes);\n\t}\n\treturn assignedNodes;\n}\n\n/**\n * implements https://w3c.github.io/accname/#mapping_additional_nd_te\n * @param root\n * @param options\n * @returns\n */\nexport function computeTextAlternative(\n\troot: Element,\n\toptions: ComputeTextAlternativeOptions = {}\n): string {\n\tconst consultedNodes = new SetLike<Node>();\n\n\tconst window = safeWindow(root);\n\tconst {\n\t\tcompute = \"name\",\n\t\tcomputedStyleSupportsPseudoElements = options.getComputedStyle !==\n\t\t\tundefined,\n\t\t// This might be overengineered. I don't know what happens if I call\n\t\t// window.getComputedStyle(elementFromAnotherWindow) or if I don't bind it\n\t\t// the type declarations don't require a `this`\n\t\t// eslint-disable-next-line no-restricted-properties\n\t\tgetComputedStyle = window.getComputedStyle.bind(window),\n\t\thidden = false,\n\t} = options;\n\n\t// 2F.i\n\tfunction computeMiscTextAlternative(\n\t\tnode: Node,\n\t\tcontext: { isEmbeddedInLabel: boolean; isReferenced: boolean }\n\t): string {\n\t\tlet accumulatedText = \"\";\n\t\tif (isElement(node) && computedStyleSupportsPseudoElements) {\n\t\t\tconst pseudoBefore = getComputedStyle(node, \"::before\");\n\t\t\tconst beforeContent = getTextualContent(pseudoBefore);\n\t\t\taccumulatedText = `${beforeContent} ${accumulatedText}`;\n\t\t}\n\n\t\t// FIXME: Including aria-owns is not defined in the spec\n\t\t// But it is required in the web-platform-test\n\t\tconst childNodes = isHTMLSlotElement(node)\n\t\t\t? getSlotContents(node)\n\t\t\t: ArrayFrom(node.childNodes).concat(queryIdRefs(node, \"aria-owns\"));\n\t\tchildNodes.forEach((child) => {\n\t\t\tconst result = computeTextAlternative(child, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t\trecursion: true,\n\t\t\t});\n\t\t\t// TODO: Unclear why display affects delimiter\n\t\t\t// see https://github.com/w3c/accname/issues/3\n\t\t\tconst display = isElement(child)\n\t\t\t\t? getComputedStyle(child).getPropertyValue(\"display\")\n\t\t\t\t: \"inline\";\n\t\t\tconst separator = display !== \"inline\" ? \" \" : \"\";\n\t\t\t// trailing separator for wpt tests\n\t\t\taccumulatedText += `${separator}${result}${separator}`;\n\t\t});\n\n\t\tif (isElement(node) && computedStyleSupportsPseudoElements) {\n\t\t\tconst pseudoAfter = getComputedStyle(node, \"::after\");\n\t\t\tconst afterContent = getTextualContent(pseudoAfter);\n\t\t\taccumulatedText = `${accumulatedText} ${afterContent}`;\n\t\t}\n\n\t\treturn accumulatedText.trim();\n\t}\n\n\t/**\n\t *\n\t * @param element\n\t * @param attributeName\n\t * @returns A string non-empty string or `null`\n\t */\n\tfunction useAttribute(\n\t\telement: Element,\n\t\tattributeName: string\n\t): string | null {\n\t\tconst attribute = element.getAttributeNode(attributeName);\n\t\tif (\n\t\t\tattribute !== null &&\n\t\t\t!consultedNodes.has(attribute) &&\n\t\t\tattribute.value.trim() !== \"\"\n\t\t) {\n\t\t\tconsultedNodes.add(attribute);\n\t\t\treturn attribute.value;\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction computeTooltipAttributeValue(node: Node): string | null {\n\t\tif (!isElement(node)) {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn useAttribute(node, \"title\");\n\t}\n\n\tfunction computeElementTextAlternative(node: Node): string | null {\n\t\tif (!isElement(node)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// https://w3c.github.io/html-aam/#fieldset-and-legend-elements\n\t\tif (isHTMLFieldSetElement(node)) {\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLLegendElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isHTMLTableElement(node)) {\n\t\t\t// https://w3c.github.io/html-aam/#table-element\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isHTMLTableCaptionElement(child)) {\n\t\t\t\t\treturn computeTextAlternative(child, {\n\t\t\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (isSVGSVGElement(node)) {\n\t\t\t// https://www.w3.org/TR/svg-aam-1.0/\n\t\t\tconsultedNodes.add(node);\n\t\t\tconst children = ArrayFrom(node.childNodes);\n\t\t\tfor (let i = 0; i < children.length; i += 1) {\n\t\t\t\tconst child = children[i];\n\t\t\t\tif (isSVGTitleElement(child)) {\n\t\t\t\t\treturn child.textContent;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t} else if (getLocalName(node) === \"img\" || getLocalName(node) === \"area\") {\n\t\t\t// https://w3c.github.io/html-aam/#area-element\n\t\t\t// https://w3c.github.io/html-aam/#img-element\n\t\t\tconst nameFromAlt = useAttribute(node, \"alt\");\n\t\t\tif (nameFromAlt !== null) {\n\t\t\t\treturn nameFromAlt;\n\t\t\t}\n\t\t} else if (isHTMLOptGroupElement(node)) {\n\t\t\tconst nameFromLabel = useAttribute(node, \"label\");\n\t\t\tif (nameFromLabel !== null) {\n\t\t\t\treturn nameFromLabel;\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tisHTMLInputElement(node) &&\n\t\t\t(node.type === \"button\" ||\n\t\t\t\tnode.type === \"submit\" ||\n\t\t\t\tnode.type === \"reset\")\n\t\t) {\n\t\t\t// https://w3c.github.io/html-aam/#input-type-text-input-type-password-input-type-search-input-type-tel-input-type-email-input-type-url-and-textarea-element-accessible-description-computation\n\t\t\tconst nameFromValue = useAttribute(node, \"value\");\n\t\t\tif (nameFromValue !== null) {\n\t\t\t\treturn nameFromValue;\n\t\t\t}\n\n\t\t\t// TODO: l10n\n\t\t\tif (node.type === \"submit\") {\n\t\t\t\treturn \"Submit\";\n\t\t\t}\n\t\t\t// TODO: l10n\n\t\t\tif (node.type === \"reset\") {\n\t\t\t\treturn \"Reset\";\n\t\t\t}\n\t\t}\n\n\t\tconst labels = getLabels(node);\n\t\tif (labels !== null && labels.length !== 0) {\n\t\t\tconsultedNodes.add(node);\n\t\t\treturn ArrayFrom(labels)\n\t\t\t\t.map((element) => {\n\t\t\t\t\treturn computeTextAlternative(element, {\n\t\t\t\t\t\tisEmbeddedInLabel: true,\n\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\trecursion: true,\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.filter((label) => {\n\t\t\t\t\treturn label.length > 0;\n\t\t\t\t})\n\t\t\t\t.join(\" \");\n\t\t}\n\n\t\t// https://w3c.github.io/html-aam/#input-type-image-accessible-name-computation\n\t\t// TODO: wpt test consider label elements but html-aam does not mention them\n\t\t// We follow existing implementations over spec\n\t\tif (isHTMLInputElement(node) && node.type === \"image\") {\n\t\t\tconst nameFromAlt = useAttribute(node, \"alt\");\n\t\t\tif (nameFromAlt !== null) {\n\t\t\t\treturn nameFromAlt;\n\t\t\t}\n\n\t\t\tconst nameFromTitle = useAttribute(node, \"title\");\n\t\t\tif (nameFromTitle !== null) {\n\t\t\t\treturn nameFromTitle;\n\t\t\t}\n\n\t\t\t// TODO: l10n\n\t\t\treturn \"Submit Query\";\n\t\t}\n\n\t\tif (hasAnyConcreteRoles(node, [\"button\"])) {\n\t\t\t// https://www.w3.org/TR/html-aam-1.0/#button-element\n\t\t\tconst nameFromSubTree = computeMiscTextAlternative(node, {\n\t\t\t\tisEmbeddedInLabel: false,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t\tif (nameFromSubTree !== \"\") {\n\t\t\t\treturn nameFromSubTree;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tfunction computeTextAlternative(\n\t\tcurrent: Node,\n\t\tcontext: {\n\t\t\tisEmbeddedInLabel: boolean;\n\t\t\tisReferenced: boolean;\n\t\t\trecursion: boolean;\n\t\t}\n\t): string {\n\t\tif (consultedNodes.has(current)) {\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// 2A\n\t\tif (\n\t\t\t!hidden &&\n\t\t\tisHidden(current, getComputedStyle) &&\n\t\t\t!context.isReferenced\n\t\t) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\" as FlatString;\n\t\t}\n\n\t\t// 2B\n\t\tconst labelElements = queryIdRefs(current, \"aria-labelledby\");\n\t\tif (\n\t\t\tcompute === \"name\" &&\n\t\t\t!context.isReferenced &&\n\t\t\tlabelElements.length > 0\n\t\t) {\n\t\t\treturn labelElements\n\t\t\t\t.map((element) =>\n\t\t\t\t\tcomputeTextAlternative(element, {\n\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\tisReferenced: true,\n\t\t\t\t\t\t// thais isn't recursion as specified, otherwise we would skip\n\t\t\t\t\t\t// `aria-label` in\n\t\t\t\t\t\t// <input id=\"myself\" aria-label=\"foo\" aria-labelledby=\"myself\"\n\t\t\t\t\t\trecursion: false,\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t\t.join(\" \");\n\t\t}\n\n\t\t// 2C\n\t\t// Changed from the spec in anticipation of https://github.com/w3c/accname/issues/64\n\t\t// spec says we should only consider skipping if we have a non-empty label\n\t\tconst skipToStep2E =\n\t\t\tcontext.recursion && isControl(current) && compute === \"name\";\n\t\tif (!skipToStep2E) {\n\t\t\tconst ariaLabel = (\n\t\t\t\t(isElement(current) && current.getAttribute(\"aria-label\")) ||\n\t\t\t\t\"\"\n\t\t\t).trim();\n\t\t\tif (ariaLabel !== \"\" && compute === \"name\") {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn ariaLabel;\n\t\t\t}\n\n\t\t\t// 2D\n\t\t\tif (!isMarkedPresentational(current)) {\n\t\t\t\tconst elementTextAlternative = computeElementTextAlternative(current);\n\t\t\t\tif (elementTextAlternative !== null) {\n\t\t\t\t\tconsultedNodes.add(current);\n\t\t\t\t\treturn elementTextAlternative;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// special casing, cheating to make tests pass\n\t\t// https://github.com/w3c/accname/issues/67\n\t\tif (hasAnyConcreteRoles(current, [\"menu\"])) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn \"\";\n\t\t}\n\n\t\t// 2E\n\t\tif (skipToStep2E || context.isEmbeddedInLabel || context.isReferenced) {\n\t\t\tif (hasAnyConcreteRoles(current, [\"combobox\", \"listbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tconst selectedOptions = querySelectedOptions(current);\n\t\t\t\tif (selectedOptions.length === 0) {\n\t\t\t\t\t// defined per test `name_heading_combobox`\n\t\t\t\t\treturn isHTMLInputElement(current) ? current.value : \"\";\n\t\t\t\t}\n\t\t\t\treturn ArrayFrom(selectedOptions)\n\t\t\t\t\t.map((selectedOption) => {\n\t\t\t\t\t\treturn computeTextAlternative(selectedOption, {\n\t\t\t\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\t\t\t\tisReferenced: false,\n\t\t\t\t\t\t\trecursion: true,\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.join(\" \");\n\t\t\t}\n\t\t\tif (hasAbstractRole(current, \"range\")) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\tif (current.hasAttribute(\"aria-valuetext\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuetext\")!;\n\t\t\t\t}\n\t\t\t\tif (current.hasAttribute(\"aria-valuenow\")) {\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- safe due to hasAttribute guard\n\t\t\t\t\treturn current.getAttribute(\"aria-valuenow\")!;\n\t\t\t\t}\n\t\t\t\t// Otherwise, use the value as specified by a host language attribute.\n\t\t\t\treturn current.getAttribute(\"value\") || \"\";\n\t\t\t}\n\t\t\tif (hasAnyConcreteRoles(current, [\"textbox\"])) {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn getValueOfTextbox(current);\n\t\t\t}\n\t\t}\n\n\t\t// 2F: https://w3c.github.io/accname/#step2F\n\t\tif (\n\t\t\tallowsNameFromContent(current) ||\n\t\t\t(isElement(current) && context.isReferenced) ||\n\t\t\tisNativeHostLanguageTextAlternativeElement(current) ||\n\t\t\tisDescendantOfNativeHostLanguageTextAlternativeElement(current)\n\t\t) {\n\t\t\tconst accumulatedText2F = computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t\tif (accumulatedText2F !== \"\") {\n\t\t\t\tconsultedNodes.add(current);\n\t\t\t\treturn accumulatedText2F;\n\t\t\t}\n\t\t}\n\n\t\tif (current.nodeType === current.TEXT_NODE) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn current.textContent || \"\";\n\t\t}\n\n\t\tif (context.recursion) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn computeMiscTextAlternative(current, {\n\t\t\t\tisEmbeddedInLabel: context.isEmbeddedInLabel,\n\t\t\t\tisReferenced: false,\n\t\t\t});\n\t\t}\n\n\t\tconst tooltipAttributeValue = computeTooltipAttributeValue(current);\n\t\tif (tooltipAttributeValue !== null) {\n\t\t\tconsultedNodes.add(current);\n\t\t\treturn tooltipAttributeValue;\n\t\t}\n\n\t\t// TODO should this be reachable?\n\t\tconsultedNodes.add(current);\n\t\treturn \"\";\n\t}\n\n\treturn asFlatString(\n\t\tcomputeTextAlternative(root, {\n\t\t\tisEmbeddedInLabel: false,\n\t\t\t// by spec computeAccessibleDescription starts with the referenced elements as roots\n\t\t\tisReferenced: compute === \"description\",\n\t\t\trecursion: false,\n\t\t})\n\t);\n}\n"]},"metadata":{},"sourceType":"module"}